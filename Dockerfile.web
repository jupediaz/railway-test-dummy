# Web service - Next.js app
FROM node:18-alpine

WORKDIR /app

# Copy package.json and install dependencies
COPY web/package.json ./
RUN npm install

# Copy source files
COPY web/ ./

# Build the Next.js app
RUN npm run build

# Create non-root user for security
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nextjs --ingroup nodejs && \
    chown -R nextjs:nodejs /app
USER nextjs

CMD ["sh", "-c", "npm start -- -p ${PORT:-3000}"]